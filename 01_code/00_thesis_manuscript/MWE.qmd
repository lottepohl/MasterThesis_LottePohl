---
title: Vertical movement behaviour of the starry smooth-hound shark *Mustelus asterias* in the North Sea
subtitle: Master Thesis
author:
  - name: Lotte Pohl
    email: lotte.pohl@imbrsea.eu
    affiliations: 
        - id: VLIZ
          name: Flemish Marine Institute
          department: Marine Observation Centre
          address: Slipwaykaai 2
          city: Ostend
          state: Belgium
          postal-code: 8400
        - id: UGent
          name: Ghent University
          department: Marine Biology research group
          address: Krijgslaan 281/S8
          city: Ghent
          state: Belgium
          postal-code: 9000
    attributes:
        corresponding: true
    note: Msc Student
  - name: Niels Brevé
    email: breve@sportvisserijnederland.nl
    affiliations:
      - id: WUR
        name: Wageningen University and Research
        department: Marine Ecology Group
        address: Droevendaalsesteeg 1
        city: Wageningen
        state: The Netherlands
        postal-code: 6700
      - id: Sportvisserij
        name: Sportvisserij Nederlands
        address: Leyenseweg 115
        city: Bilthoven
        state: The Netherlands
        postal-code: 3721
    note: Second Promotor
  - name: Carlota Muñiz
    email: carlota.muniz@vliz.be
    affiliations:
        - ref: VLIZ
    note: Supervisor
  - name: Jan Reubens
    email: jan.reubens@vliz.be
    affiliations:
        - ref: VLIZ
    note: Promotor
abstract: 
 Still to be written.
keywords: 
  - acoustic telemetry
  - geolocation modelling
  - Mustelus asterias
date: last-modified
bibliography: bibliography.bib
execute:
  echo: false
  include: false
knitr:
  opts_knit:
    root.dir: "C:/Users/lotte.pohl/Documents/github_repos/MasterThesis_LottePohl/"
    verbose: TRUE
# output:
#   pdf_document:
#     css: custom.css
#     output_dir: "C:/Users/lotte.pohl/Documents/github_repos/MasterThesis_LottePohl/01_code/00_thesis_manuscript/test"
#     base_url: "http://localhost:3478/01_code/00_thesis_manuscript/test"
format:
  #     - title.tex
  # pdf: default
  # pdf: # bmc template
  #   template: bmc_template/bmc_article.tex
  #   template-partials:
  elsevier-pdf:
    keep-tex: true
    toc: true
    journal:
      #   - Highlight 1
      #   - Highlight 2
      #   - Highlight 3
      # - top=2 0mm
      # - left=20mm
      # - heightrounded
      name: Journal of Animal Biotelemetry
      formatting: review # or preprint, or doubleblind
      linestretch: 2
      model: 3p
      cite-style: authoryear
      # graphical-abstract: "![](abstract.png)"
      # highlights:
        
      # fig-width: 6.7
      # fig-height: 4.5
      # geometry:
      # tbl-cap-location: top
editor_options: 
  chunk_output_type: console
header-includes:
  - \newcommand{\mycommand}[1]{\textbf{#1}}
# crossref:
#   fig-title: '**Figure**'
#   fig-labels: arabic
#   title-delim: "**.**"
# quarto:
#   figure:
#     caption:
#       format: "<b>Figure %s.</b> %s"
---

```{r packages}
library(dplyr)
# library(tidyverse)
# library(leaflet)
# library(ggplot2)
library(tibble)
# library(magrittr)
library(knitr)
library(usethis)
library(kableExtra)
# library(biwavelet)
# rm(list = ls())
```

```{r workspace}
# load functions
paste0(getwd(), "/01_code/06_functions/functions.R") %>% base::source()
paste0(getwd(), "/01_code/02_load_data/manuscript_figures/load_tables.R") %>% base::source()

# load plots, data and maps
# paste0(getwd(), "/01_code/02_load_data/manuscript_figures/load_dst_overview_plots.R") %>% base::source()

paste0(getwd(), "/01_code/02_load_data/manuscript_figures/load_plots.R") %>% base::source()

# paste0(getwd(), "/01_code/02_load_data/manuscript_figures/load_maps.R") %>% base::source()

# paste0(getwd(), "/01_code/02_load_data/load_autocorrelation_results.R") %>% base::source()

# paste0(getwd(), "/01_code/02_load_data/load_acoustic_detections.R") %>% base::source()

# paste0(getwd(), "/01_code/05_plots_maps/plots_dst_summary.R") %>% base::source()

# paste0(getwd(), "/01_code/05_plots_maps/thesis_manuscript_figures.R") %>% base::source()

# dst_summary <- load_data(filestring = "dst_summary", folder = paste0(getwd(), "/02_results/dst_summary/"))

```

<!-- ```{r} -->
<!-- path_maps <- paste0(getwd(), "/01_code/00_thesis_manuscript/maps/") -->
<!-- path_figures <- paste0(getwd(), "/01_code/00_thesis_manuscript/figures/") -->
<!-- ``` -->


<!-- ```{r setplottheme} -->
<!-- thesis_theme <- ggplot2::theme( -->
<!--   plot.title = element_text(family = "serif", size = 12, face = "bold"), -->
<!--   plot.subtitle = element_text(family = "serif", size = 12), -->
<!--   axis.title = element_text(family = "serif", size = 12), -->
<!--   axis.text = element_text(family = "serif", size = 10), -->
<!--   legend.title = element_text(family = "serif", size = 12), -->
<!--   legend.text = element_text(family = "serif", size = 10), -->
<!--   # plot.background = element_blank()#, -->
<!--   panel.background = element_blank(), -->
<!--   # panel.background = element_rect(fill = "transparent"), -->
<!--   panel.grid.major = element_line(color = "gray70", linetype = "solid"), -->
<!--   panel.grid.minor = element_line(color = "gray90", linetype = "dashed"), -->
<!-- ) -->

<!-- # Set the theme as the default for all plots -->
<!-- ggplot2::theme_set(thesis_theme) -->
<!-- ``` -->

# List of Abbreviations {-}

```{r listofabbreviations}
abbrev <- tibble::tibble(Abbreviation = c("ADST", "DST", "DVM"),
                         Explanation= c("Acoustic Data Storage Tag",
                                        "Data Storage Tag",
                                        "Diel Vertical Migration"))
```


```{r table-abbreviations}
#| include: true
##| echo: false
#| label: tbl-abbreviations
#| out-width: 90%

knitr::kable(abbrev) %>% kableExtra::kable_styling(position = "center",
                                                   latex_options = "hold_position")

```

# Tables

Details on the tagged individuals are listed in @tbl-animalinfo.


```{r prepare-animalinfo}
# tagged_animal_info  <- tagged_animal_info  %>% 
#   arrange(release_date_time) %>%
#   rename(`tag serial nr.` = tag_serial_number, 
#          `TL (cm)` = length1,
#          `release date` = release_date_time, 
#          `# detected` = n_detect, 
#          `h detected` = hours_detected,
#          `d detected` = days_detected,
#          `days at liberty` = days_at_liberty,
#          `release location` = release_loc,
#          `date last detected` = date_last_detected)
# #%>% relocate(sex, .after = tag_serial_number)
```


```{r table-animalinfo}
#| include: true
#| label: tbl-animalinfo
#| out-width: 100%
#| tbl-cap-location: top
#| tbl-cap: "Information on the tagged individuals. # = times, h = hours, d = days detected. To do: exclude animals without detection, put those in Annex (maybe that's a bad idea), fix col width for table."

# dt2$Item <- linebreak(dt2$Item)
# dt2 %>%
# kable("latex", booktabs = T, escape = F,
# caption = "Main Title\\\\Subtitle",
# col.names = linebreak(c("Item\n(Name)", "Value\n(Number)"), align = "c"))
# 
# tagged_animal_info  <- tagged_animal_info  %>% 
#   arrange(release_date_time) %>%
#   rename(`tag serial nr.` = tag_serial_number, 
#          `TL (cm)` = length1,
#          `release date` = release_date_time, 
#          `# detected` = n_detect, 
#          `h detected` = hours_detected,
#          `d detected` = days_detected,
#          `days at liberty` = days_at_liberty,
#          `release location` = release_loc,
#          `date last detected` = date_last_detected)

knitr::kable(x = tagged_animal_info %>% 
               #set column order & order rows
               dplyr::select(tag_serial_number, sex, length1,
                             release_date_time, n_detect, days_detected,
                             hours_detected, date_last_detected, 
                             days_at_liberty, release_loc) %>%
               arrange(release_date_time) %>%
               mutate(release_loc = ifelse(release_loc == "Neeltje Jans", 1, 2)),
             booktabs = T, escape = F,
             col.names = linebreak(c("tag serial\nnr.", "sex", "TL\n in cm", "release date", "times\ndetected", "days\ndetected","hours\ndetected", "date last\ndetected", "days at\nliberty", "release\nlocation"), align = "c")) %>%
  kableExtra::kable_styling(position = "center", latex_options = "hold_position")
```



see @tbl-tests.

```{r tableprepare}

table <- tibble(`A long\ncolumn name` = seq(1:5))
# table %>% linebreak(align = "c")

```

```{r table-tests}
#| include: false
#| echo: true
#| label: tbl-tests
#| out-width: 90%

dt2 <- data.frame(
Item = c("Hello\nWorld", "This\nis a cat"),
Value = c(10, 100)
)
dt2$Item <- linebreak(dt2$Item)
dt2 %>%
kable("latex", booktabs = T, escape = F,
caption = "Main Title\\\\Subtitle",
col.names = linebreak(c("Item\n(Name)", "Value\n(Number)"), align = "c"))


# library(kableExtra)
# 
# # generate a data frame with long column names
# df <- data.frame("Long\nColumn Name 1" = rnorm(10), "Long \n Column Name 2" = rnorm(10))
# 
# knitr::kable(df) %>% kableExtra::kable_styling(position = "center",
#                                                    latex_options = "hold_position")

# # use kable with booktabs and latex_options
# kable(df, format = "latex", booktabs = TRUE) %>% #,      latex_options = "hold_position"
#   kable_styling(latex_options = c("striped", "scale_down")) %>%
#   # use column_spec to fix column widths and force line breaks
#   column_spec(1:2, width = "3cm") #, escape = FALSE
# 


```


# Maps


Test map cross reference @fig-map.

```{r maptest}
#| include: true
#| echo: false
#| label: "fig-map"
#| fig-cap: "test map."


knitr::include_graphics(path = "C:/Users/lotte.pohl/Documents/github_repos/MasterThesis_LottePohl/01_code/00_thesis_manuscript/maps/map1_overview_manual.png", rel_path = FALSE)

```

Test map cross reference @fig-map.

# Plots



```{r allresults308}
#| include: true
#| label: fig-allresults308
#| out-width: 85%
#| fig-height: 2.5
#| layout-ncol: 1
#| fig-cap: "All results for tag 308."
#| fig-subcap: 
#| - "Raw depthlog."
#| - "Autocorrelation of daily median depth (?)"
#| - "Daily median, minimum and maximum depth and daily vertical migration behaviour."
#| - "periodogram of the raw depth data"
#| fig-pos: "H"

p_dst_raw_308

p_acf_308

p_308_sum_stats

p_fft_308
```



<!-- ```{r wavelet-median} -->
<!-- #| include: true -->
<!-- #| label: fig-wave_depthmedian -->
<!-- #| layout-ncol: 1 -->
<!-- #| column: body #page -->
<!-- #| fig-width: 8 -->
<!-- #| fig-cap: "Wavelet transform results from the daily median depth." -->
<!-- #| fig-subcap:  -->
<!-- #| - "female shark (tag 308)" -->
<!-- #| - "male shark (tag 321)" -->

<!-- p_308_wavelet_depth_median_roll3 -->

<!-- p_321_wavelet_depth_median_roll3 -->
<!-- ``` -->


